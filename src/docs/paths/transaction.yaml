/api/transactions:
  post:
    summary: Create New Transaction with Attachments
    description: Create a new transaction. Handles multipart/form-data for file uploads. Accessible by users with ADMIN, OWNER, TREASURER, or AUDITOR roles.
    tags:
      - Transaction
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              amount:
                type: number
                format: double
              type:
                type: string
                enum: [INCOME, EXPENSE]
              description:
                type: string
              transactionDate:
                type: string
                format: date-time
              projectId:
                type: string
                format: uuid
              categoryId:
                type: string
                format: uuid
              attachments:
                type: array
                nullable: true
                description: Optional. Allowed formats: JPG, PNG, PDF.
                items:
                  type: string
                  format: binary
            required:
              - amount
              - type
              - description
              - transactionDate
          encoding:
            attachments:
              contentType: image/png, image/jpeg, application/pdf
    responses:
      '201':
        description: Transaction created successfully and queued for blockchain confirmation.
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
                data:
                  type: object
        example:
          success: true
          message: "Transaction recorded and queued for blockchain confirmation."
          data:
            id: "txn_12345"
            status: "Pending"
            blockchainHash: "0xabcde..."
      '400':
        description: Validation error (e.g., invalid data format).
      '403':
        description: Forbidden (user is not a member of the organization).

  get:
    summary: List All Transactions for an Organization
    description: List transactions for an organization with pagination. Accessible by all organization members (ADMIN, OWNER, MANAGER, MEMBER, VIEWER roles).
    tags:
      - Transaction
    security:
      - bearerAuth: []
    parameters:
      - in: query
        name: projectId
        schema:
          type: string
          format: uuid
        required: false
        description: Filter transactions by Project ID.
      - in: query
        name: page
        schema:
          type: integer
          default: 1
        description: The page number for pagination.
      - in: query
        name: limit
        schema:
          type: integer
          default: 20
        description: The number of items per page.
    responses:
      '200':
        description: A paginated list of transactions.
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: array
                  items:
                    type: object
      '400':
        description: Validation error.
      '403':
        description: Forbidden.

/api/transactions/{id}:
  get:
    summary: Get Transaction Details
    description: Get transaction details. Accessible by all organization members (ADMIN, OWNER, MANAGER, MEMBER, VIEWER roles).
    tags:
      - Transaction
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
        description: Transaction ID
    responses:
      '200':
        description: Transaction details retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
      '404':
        description: Transaction not found

  put:
    summary: Update Transaction
    description: Update transaction details. Changing critical fields (amount, type, date) will regenerate the integrity hash. Accessible by users with ADMIN, OWNER, TREASURER, or AUDITOR roles.
    tags:
      - Transaction
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              amount:
                type: number
              type:
                type: string
                enum: [INCOME, EXPENSE]
              description:
                type: string
              transactionDate:
                type: string
                format: date-time
              projectId:
                type: string
                format: uuid
              categoryId:
                type: string
                format: uuid
    responses:
      '200':
        description: Transaction updated
        content:
           application/json:
             schema:
               type: object
               properties:
                 success:
                   type: boolean
                 message:
                   type: string
                 data:
                   type: object
      '400':
        description: Validation error

  delete:
    summary: Delete Transaction
    description: Delete transaction. Accessible by users with ADMIN, OWNER, TREASURER, or AUDITOR roles.
    tags:
      - Transaction
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
    responses:
      '200':
        description: Transaction deleted successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string


/api/transactions/statistics:
  get:
    summary: Get Dashboard Statistics
    description: Retrieves aggregated financial statistics for the user's organization, including total income, total expenses, and the number of anomalous transactions. Accessible by all organization members.
    tags:
      - Transaction
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Successfully retrieved dashboard statistics.
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    totalAmountIncome:
                      type: number
                      format: double
                      example: 150000.75
                    totalAmountExpense:
                      type: number
                      format: double
                      example: 75000.50
                    totalAnomaly:
                      type: integer
                      example: 5
                    totalTransaction:
                      type: integer
                      example: 100
      '401':
        description: Unauthorized - No authentication token or invalid token.
      '400':
        description: Bad request or an unexpected error occurred.

/api/transactions/{id}/verify:
  get:
    summary: Verify Transaction Integrity
    description: Verify the integrity of a single transaction against the blockchain. Restricted to users with ADMIN, OWNER, TREASURER, or AUDITOR roles.
    tags:
      - Transaction
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
        description: The ID of the transaction to verify.
    responses:
      '200':
        description: The result of the integrity verification.
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    isVerifiable:
                      type: boolean
                    isIntegral:
                      type: boolean
                    status:
                      type: string
                      enum: [VERIFIED, TAMPERED, CHAIN_MISMATCH_OR_MOCK, PENDING]
                    message:
                      type: string
      '403':
        description: Forbidden.
      '404':
        description: Transaction not found.